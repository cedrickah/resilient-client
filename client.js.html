<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: client.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: client.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import CircuitBreaker from "opossum";
import Fetcher from "./fetcher";
import { getBreakerIndex } from "./utils";
/**
 * Constructs a ResilientClient.
 *
 * @class Client
 * @param {CircuitBreaker.Options} circuitBreakerOptions Options for the circuit breaker
 * @param {AxiosRequestConfig} requestOptions Options for the {@link Fetcher}
 */
class Client {
    constructor(circuitBreakerOptions, requestOptions) {
        this._circuits = new Map();
        this._cbOptions = circuitBreakerOptions;
        this._fetcher = new Fetcher(requestOptions);
    }
    /**
     * Perform a HTTP request that might fails
     *
     * @param {AxiosRequestConfig} fetchConfig Options for the {@link Fetcher}
     * @return {Promise&lt;AxiosResponse>} Promise resolves with the HTTP response
     * on success or is rejected on failure of the action. Use isBreakerError()
     * to determine if a rejection was a result of the circuit breaker or the
     * HTTP call.
     */
    request(fetchConfig) {
        const { method, url } = fetchConfig;
        if (method &amp;&amp; url) {
            let breaker;
            const abortController = new AbortController();
            const circuitBreakerOptions = Object.assign({ abortController }, this._cbOptions);
            const circuitIndexObject = {
                requestMethod: method,
                requestURL: url,
            };
            const circuitIndexString = getBreakerIndex(circuitIndexObject);
            if (this._circuits.has(circuitIndexString)) {
                breaker = this._circuits.get(circuitIndexString);
            }
            else {
                breaker = new CircuitBreaker(this._fetcher.exec, circuitBreakerOptions);
                this._circuits.set(circuitIndexString, breaker);
            }
            return breaker.fire(circuitBreakerOptions.abortController.signal, fetchConfig);
        }
        else {
            throw new Error("Method and URL are required in request config");
        }
    }
    /**
     * Returns true if the provided error was generated by an circuit breaker. It will be false
     * if the error came from the action itself.
     *
     * @param {Error} error The Error to check
     * @returns {Boolean} true if the error was generated by an circuit breaker
     */
    static isBreakerError(error) {
        return CircuitBreaker.isOurError(error);
    }
    /**
     * Get an specific circuit breaker.
     * Helpful when you need to get stats from a circuit breaker.
     *
     * @param {BreakerIndexObject} indexObject IndexObject contains the URL and method of the request
     * associated with a circuit breaker. Request and URL together are used as index for the circuit breaker.
     * They can be formatted into an string index using {@link BreakerIndexObject}
     * @returns {CircuitBreaker} Circuit breaker
     */
    getCircuitBreaker(indexObject) {
        const index = getBreakerIndex(indexObject);
        const breaker = this._circuits.get(index);
        if (breaker) {
            return breaker;
        }
        else {
            throw new Error(`There is no circuit breaker with index ${index}`);
        }
    }
}
export default Client;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Client.html">Client</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Feb 09 2025 15:10:15 GMT+0100 (West Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
